<!DOCTYPE html>
<!--
Copyright (C) 2016 Sebastian Pipping <sebastian@pipping.org>
Licensed under GNU GPL v3 or later

{% load static %}
-->
<html lang="en">
    <head>
        <title>jawanndenn: Vote!</title>

        <meta name="viewport" content="width=device-width, initial-scale=1">

        <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="{% static '3rdparty/noty-2.4.1/js/noty/packaged/jquery.noty.packaged.min.js' %}"></script>

        <link rel="stylesheet" href="{% static '3rdparty/materialize-v0.100.2/css/materialize.min.css' %}">
        <script src="{% static '3rdparty/materialize-v0.100.2/js/materialize.min.js' %}"></script>

        <script type="text/javascript" src="{% static 'js/html.js' %}?sha1=85e9e5f0be4160539a04f4af533093f1616820f6"></script>
        <script type="text/javascript" src="{% static 'js/poll.js' %}?sha1=5342f6f12026a4027a2cc70eed0e79736323f6a6"></script>
        <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}?sha1=7bc5e514037fa511bcf6b93b31778a96920387b6">

        <script type="text/javascript">
            $( document ).ready(function() {
                var pollId = /[0-9a-fA-F]{64}/.exec(window.location.pathname)[0]
                var pollDataUrl = '{% url 'poll-data' poll_id='POLL_ID' %}'.replace( 'POLL_ID', pollId );
                var voteUrl = '{% url 'vote' poll_id='POLL_ID' %}'.replace( 'POLL_ID', pollId );

                $.get( pollDataUrl, function(data) {
                    var poll = $( '#poll' );
                    poll.html( createPollHtml( data.config, data.votes, Mode.LIVE, '{{ csrf_token }}' ) );
                    $( '#pollForm' ).attr( 'action', voteUrl );
                    if (data.config.equal_width) {
                        equalizeWidth( poll );
                    }
                }, 'json')
                .fail(function() {
                    var html = 'Error: Poll data could not be loaded.';
                    noty({text: html, type: 'error', timeout: null});
                });
            });
        </script>
    </head>
    <body>
        <div id='live'>
            <div id='poll'></div>
        </div>
        <footer></footer>
    </body>
</html>
